<div class="multiselect-container" [ngClass]="'variant-' + variant">
  
  <!-- Default/Filled State - Closed -->
  <div *ngIf="!isOpen" class="multiselect-trigger" (click)="toggleDropdown()">
    
    <!-- Default/Open - Single Select Display -->
    <div *ngIf="selectedValues.length === 0" class="trigger-content">
      <span class="placeholder">{{ placeholder }}</span>
      <mat-icon class="chevron-icon">expand_more</mat-icon>
    </div>

    <!-- Filled - Single Item Selected -->
    <div *ngIf="selectedValues.length === 1 && variant === 'filled'" class="trigger-content filled">
      <span class="selected-text">{{ selectedLabels[0] }}</span>
      <div class="actions">
        <button class="clear-btn" (click)="clearAll($event)" [disabled]="disabled">
          <mat-icon>close</mat-icon>
          <span>Clear</span>
        </button>
        <mat-icon class="chevron-icon">expand_more</mat-icon>
      </div>
    </div>

    <!-- Multiple Items Selected - Show chips -->
    <div *ngIf="selectedValues.length > 1" class="trigger-content multi-select">
      <div class="selection-chips">
        <div *ngFor="let value of selectedValues.slice(0, 4); let i = index" class="selection-chip">
          <span class="chip-text">{{ i + 1 }}</span>
          <button class="chip-remove" (click)="removeSelection(value, $event)" [disabled]="disabled">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
      <mat-icon class="chevron-icon">expand_more</mat-icon>
    </div>
  </div>

  <!-- Open State - Dropdown -->
  <div *ngIf="isOpen" class="multiselect-dropdown">
    
    <!-- Search Input -->
    <div class="dropdown-header">
      <input
        type="text"
        class="search-input"
        [placeholder]="placeholder"
        [value]="searchTerm"
        (input)="onSearch($event)"
        [disabled]="disabled"
      />
      <mat-icon class="chevron-icon-up" (click)="toggleDropdown()">expand_less</mat-icon>
    </div>

    <!-- Divider -->
    <div class="divider"></div>

    <!-- Options List -->
    <div class="options-list">
      <div
        *ngFor="let option of filteredOptions"
        class="option-item"
        [class.selected]="isSelected(option.value)"
        (click)="toggleOption(option.value)"
      >
        {{ option.label }}
      </div>
    </div>
  </div>

</div>